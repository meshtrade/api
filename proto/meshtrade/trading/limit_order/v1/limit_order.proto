syntax = "proto3";

package meshtrade.trading.limit_order.v1;

import "buf/validate/validate.proto";
import "meshtrade/type/v1/amount.proto";

option go_package = "github.com/meshtrade/api/go/trading/limit_order/v1;limit_order_v1";
option java_package = "co.meshtrade.api.trading.limit_order.v1";

/*
   LimitOrder resource representing a limit order for trading on the Mesh platform.

   Limit orders enable traders to specify price and quantity for buying or selling
   instruments on supported ledgers. Each order is owned by a group and associated
   with a specific account.
*/
message LimitOrder {
  // Reserved field numbers for removed fields.
  reserved 4;
  reserved "display_name";

  /*
     The unique resource name for the limit order.
     Format: limit_orders/{ULIDv2}.
     This field is system-generated and immutable upon creation.
     Any value provided on creation is ignored.
  */
  string name = 1 [(buf.validate.field) = {
    cel: {
      id: "name.format.optional"
      message: "name must be empty or in the format limit_orders/{ULIDv2}"
      expression: "size(this) == 0 || this.matches('^limit_orders/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$')"
    }
  }];

  /*
     The resource name of the parent group that owns this limit order.
     This field is required on creation and establishes the direct ownership link.
     Format: groups/{ULIDv2}.
  */
  string owner = 2 [(buf.validate.field) = {
    required: true
    string: {
      len: 33
      pattern: "^groups/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
    }
  }];

  /*
     The account associated with this limit order.
     Format: accounts/{ULIDv2}.
     This field is required on creation.
  */
  string account = 3 [(buf.validate.field) = {
    required: true
    string: {
      len: 35
      pattern: "^accounts/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
    }
  }];

  /*
     External reference for client-side tracking and correlation.
     This field allows clients to associate orders with their own identifiers.

     If specified, must be unique within the scope of limit orders owned by
     this owner. The Mesh system enforces this constraint to ensure reliable
     lookups via GetLimitOrderByExternalReference.
  */
  string external_reference = 5 [(buf.validate.field) = {
    string: {max_len: 200}
  }];

  /*
     Order side indicating buy or sell.
     This field is required on creation.
  */
  LimitOrderSide side = 6 [(buf.validate.field) = {
    enum: {
      defined_only: true
      not_in: [0]
    }
  }];

  /*
     Limit price for the order.
     This field is required on creation.
  */
  meshtrade.type.v1.Amount limit_price = 7 [(buf.validate.field) = {required: true}];

  /*
     Order quantity.
     This field is required on creation.
  */
  meshtrade.type.v1.Amount quantity = 8 [(buf.validate.field) = {required: true}];

  /*
     Fill price from live ledger data.
     Calculated as the volume weighted average price (VWAP) of all trades
     that filled this order. This value is computed in real-time from ledger
     data and becomes final when the order is marked complete.

     Only populated when live_ledger_data=true in request.
  */
  meshtrade.type.v1.Amount fill_price = 9;

  /*
     Filled quantity from live ledger data.
     Represents the total amount of the order that has been filled on the ledger.
     This value is computed in real-time from ledger data and becomes final
     when the order is marked complete.

     Only populated when live_ledger_data=true in request.
  */
  meshtrade.type.v1.Amount filled_quantity = 10;

  /*
     Limit Order life cycle state.
  */
  LimitOrderState state = 11;
}

/*
   LimitOrderSide represents the direction of a limit order.
*/
enum LimitOrderSide {
  // Unspecified side (invalid for creation).
  LIMIT_ORDER_SIDE_UNSPECIFIED = 0;

  // Buy order.
  LIMIT_ORDER_SIDE_BUY = 1;

  // Sell order.
  LIMIT_ORDER_SIDE_SELL = 2;
}

/*
   LimitOrderState represents the current life-cycle state of a limit order.
*/
enum LimitOrderState {
  // Unspecified status.
  LIMIT_ORDER_STATUS_UNSPECIFIED = 0;

  // Submission transaction in progress.
  LIMIT_ORDER_STATUS_SUBMISSION_IN_PROGRESS = 1;

  // Submission failed.
  LIMIT_ORDER_STATUS_SUBMISSION_FAILED = 2;

  // Order is open on the ledger.
  LIMIT_ORDER_STATUS_OPEN = 3;

  // Completion in progress.
  LIMIT_ORDER_STATUS_COMPLETE_IN_PROGRESS = 4;

  // Order completed (fully filled).
  LIMIT_ORDER_STATUS_COMPLETE = 5;

  // Cancellation in progress.
  LIMIT_ORDER_STATUS_CANCELLATION_IN_PROGRESS = 6;

  // Order cancelled.
  LIMIT_ORDER_STATUS_CANCELLED = 7;
}
