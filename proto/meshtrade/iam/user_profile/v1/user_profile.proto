syntax = "proto3";

package meshtrade.iam.user_profile.v1;

import "buf/validate/validate.proto";
import "meshtrade/type/v1/token.proto";

option go_package = "github.com/meshtrade/api/go/iam/user_profile/v1;user_profile_v1";
option java_package = "co.meshtrade.api.iam.user_profile.v1";

/*
   A user in the IAM service.

   Each User belongs to a specific group and has
   defined roles that determine their permissions within that group.
*/
message UserProfile {
  /*
     The unique resource name for the user.
     Format: users/{ULIDv2}.
     This field is system-generated and immutable upon creation.
     Any value provided on creation is ignored.
  */
  string name = 1 [(buf.validate.field) = {
    cel: {
      id: "name.format.optional"
      message: "name must be empty or in the format user_profiles/{ULIDv2}"
      expression: "size(this) == 0 || this.matches('^user_profiles/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$')"
    }
  }];


  /*
     The resource name of the parent group that owns this user.
     This field is required on creation and establishes the direct ownership link.
     Format: groups/{ULIDv2}.
  */
  string owner = 2 [(buf.validate.field) = {
    required: true
    string: {
      len: 33
      pattern: "^groups/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
    }
  }];

  /*
     Ownership hiearchy of groups that have access to this resource in the format groups/{group_id}.
     System set on creation.
  */
  repeated string owners = 3 [(buf.validate.field) = {
    repeated: {
      items: {
        string: {
          len: 33
          pattern: "^groups/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
        }
      }
    }
  }];

  string user = 4 [(buf.validate.field) = {
    string: {
     len: 33
     pattern: "^users/[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
    }
  }];

  string local = 5;
  string profile_picture_url = 6;
  string display_name = 7 [(buf.validate.field) = {
    required: true
  }];
  meshtrade.type.v1.Token display_currency = 8;
  meshtrade.type.v1.Token reporting_currency = 9;
}
