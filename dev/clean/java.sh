#!/usr/bin/env bash
set -Eeuo pipefail
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
ROOT_DIR="$SCRIPT_DIR/../.."

cd "$ROOT_DIR"

echo "ðŸ§¹ Cleaning Java generated files..."

# Clean generated files in co.meshtrade.api package
if [ -d "./java/src/main/java/co/meshtrade/api" ]; then
  find ./java/src/main/java/co/meshtrade/api \
    \( -name '*OuterClass.java' -o -name '*Grpc.java' -o -name 'Service.java' \) \
    -print0 | xargs -0 -r -P 4 -n 1 rm
fi

# Clean generated files in meshtrade package (in case they were generated without java_package option)
if [ -d "./java/src/main/java/meshtrade" ]; then
  echo "   Cleaning meshtrade directory..."
  rm -rf ./java/src/main/java/meshtrade
fi

# Clean custom plugin generated files (protoc-gen-meshjava)
if [ -d "./java/src/main/java/co/meshtrade/api" ] && grep -r -l "// Generated by protoc-gen-meshjava. DO NOT EDIT." ./java/src/main/java/co/meshtrade/api/ 2>/dev/null; then
  grep -r -l "// Generated by protoc-gen-meshjava. DO NOT EDIT." ./java/src/main/java/co/meshtrade/api/ 2>/dev/null | \
    xargs -r -P 4 -n 1 rm
fi

echo "âœ… Java cleanup complete"