// @generated by protoc-gen-meshts v1
// @generated from file meshtrade/iam/api_user/v1/service.proto (package meshtrade.iam.api_user.v1, syntax proto3)
/* eslint-disable */

import { createClient, type Client as ConnectClient, Interceptor } from "@connectrpc/connect";
import { createGrpcWebTransport } from "@connectrpc/connect-web";
import { APIUserService } from "./service_pb";
import {
  ActivateAPIUserRequest,
  AssignRolesToAPIUserRequest,
  CreateAPIUserRequest,
  DeactivateAPIUserRequest,
  GetAPIUserByKeyHashRequest,
  GetAPIUserRequest,
  ListAPIUsersRequest,
  ListAPIUsersResponse,
  RevokeRolesFromAPIUserRequest,
  SearchAPIUsersRequest,
  SearchAPIUsersResponse
} from "./service_pb";
import { APIUser } from "./api_user_pb";
import { ConfigOpts, getConfigFromOpts } from "../../../common/config";
import { validateRequest } from "../../../common/validation";
import { createGroupInterceptor } from "../../../common/connectInterceptors";

/**
 * Web client for interacting with the meshtrade.iam.api_user.v1 apiuser v1 API resource service.
 * Uses Connect-ES with gRPC-Web transport for browser-compatible gRPC communication.
 */
export class APIUserServiceWeb {
  private _client: ConnectClient<typeof APIUserService>;
  private readonly _config: ReturnType<typeof getConfigFromOpts>;
  private readonly _interceptors: Interceptor[];

  /**
   * Constructs an instance of APIUserServiceWeb.
   * @param {ConfigOpts} [config] - Optional configuration for the client.
   * @param {Interceptor[]} [interceptors] - For internal use by `withGroup`.
   */
  constructor(config?: ConfigOpts, interceptors?: Interceptor[]) {
    this._config = getConfigFromOpts(config);
    this._interceptors = interceptors || [];

    // Create the gRPC-Web transport with interceptors
    const transport = createGrpcWebTransport({
      baseUrl: this._config.apiServerURL,
      interceptors: this._interceptors,
      // Enable credentials (cookies) for cross-origin requests
      fetch: (input, init) => globalThis.fetch(input, { ...init, credentials: 'include' }),
    });

    // Construct the Connect-ES client
    this._client = createClient(APIUserService, transport);
  }

  /**
   * Returns a new client instance configured to send the specified group
   * resource name in the request headers for subsequent API calls.
   * 
   * @param {string} group - The operating group context to inject into the request
   *                         in the format `groups/{ulid}` where {ulid} is a 26-character ULID.
   *                         Example: 'groups/01ARZ3NDEKTSV4YWVF8F5BH32'
   * @returns {APIUserServiceWeb} A new, configured instance of the client.
   * @throws {Error} If the group format is invalid (validation occurs in createGroupInterceptor)
   */
  withGroup(group: string): APIUserServiceWeb {
    // Check if a group interceptor already exists.
    // Group interceptors are identified by having a 'groupContext' property
    const hasGroupInterceptor = this._interceptors.some(
      (interceptor: any) => interceptor.groupContext !== undefined
    );

    if (hasGroupInterceptor) {
      throw new Error(
        "Attempted to set group context twice. A group has already been set for this client instance."
      );
    }

    // Create a new interceptor for the group context
    const groupInterceptor = createGroupInterceptor(group);

    // Return a new client instance with the existing interceptors plus the new one
    return new APIUserServiceWeb(
      this._config,
      [
        ...this._interceptors,
        groupInterceptor,
      ],
    );
  }

  /**
   * Retrieves an apiuser.
   * @param {GetAPIUserRequest} request - The request object for getapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  getAPIUser(request: GetAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.getAPIUser(request);
  }

  /**
   * Creates a new apiuser.
   * @param {CreateAPIUserRequest} request - The request object for createapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  createAPIUser(request: CreateAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.createAPIUser(request);
  }

  /**
   * Performs assignrolestoapiuser operation on apiuser.
   * @param {AssignRolesToAPIUserRequest} request - The request object for assignrolestoapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  assignRolesToAPIUser(request: AssignRolesToAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.assignRolesToAPIUser(request);
  }

  /**
   * Performs revokerolesfromapiuser operation on apiuser.
   * @param {RevokeRolesFromAPIUserRequest} request - The request object for revokerolesfromapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  revokeRolesFromAPIUser(request: RevokeRolesFromAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.revokeRolesFromAPIUser(request);
  }

  /**
   * Retrieves a list of apiusers.
   * @param {ListAPIUsersRequest} request - The request object for listapiusers.
   * @returns {Promise<ListAPIUsersResponse>} A promise that resolves with the list of apiusers.
   */
  listAPIUsers(request: ListAPIUsersRequest): Promise<ListAPIUsersResponse> {
    // Validate request
    validateRequest(request);

    return this._client.listAPIUsers(request);
  }

  /**
   * Searches for apiusers.
   * @param {SearchAPIUsersRequest} request - The request object for searchapiusers.
   * @returns {Promise<SearchAPIUsersResponse>} A promise that resolves with the search results.
   */
  searchAPIUsers(request: SearchAPIUsersRequest): Promise<SearchAPIUsersResponse> {
    // Validate request
    validateRequest(request);

    return this._client.searchAPIUsers(request);
  }

  /**
   * Activates an apiuser.
   * @param {ActivateAPIUserRequest} request - The request object for activateapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  activateAPIUser(request: ActivateAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.activateAPIUser(request);
  }

  /**
   * Deactivates an apiuser.
   * @param {DeactivateAPIUserRequest} request - The request object for deactivateapiuser.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  deactivateAPIUser(request: DeactivateAPIUserRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.deactivateAPIUser(request);
  }

  /**
   * Retrieves an apiuser.
   * @param {GetAPIUserByKeyHashRequest} request - The request object for getapiuserbykeyhash.
   * @returns {Promise<APIUser>} A promise that resolves with the apiuser.
   */
  getAPIUserByKeyHash(request: GetAPIUserByKeyHashRequest): Promise<APIUser> {
    // Validate request
    validateRequest(request);

    return this._client.getAPIUserByKeyHash(request);
  }

}
