# Group Ownership Structure

Understanding how groups provide hierarchical ownership and multi-tenancy boundaries for all resources in the Mesh API.

## What are Groups?

Groups are the fundamental organizational and ownership units in Mesh. Every resource in the system (API users, accounts, orders, instruments, etc.) belongs to exactly one group. Groups themselves can own other groups, forming hierarchical tree structures that model real-world organizational relationships.

**Key Characteristics:**
- **Resource Ownership**: Every entity in the system has an owner group
- **Hierarchical Structure**: Groups can own sub-groups, creating tree structures
- **Multi-tenancy Boundaries**: Groups provide complete isolation between organizations
- **Permission Inheritance**: Access rights flow down the hierarchy

## Universal User System: API Users & Regular Users

**Important**: While this documentation focuses on "API users" due to its technical API context, the **exact same ownership and permission system applies to regular users** who access Mesh through web interfaces, mobile apps, and other user-facing applications.

### Unified Authorization Model

**Both user types follow identical patterns:**
- **Regular Users**: Authenticate via username/password, OAuth providers (Google, Microsoft, etc.), or SSO systems
- **API Users**: Authenticate via API keys for programmatic access
- **Same Permissions**: Both receive identical role assignments within groups
- **Same Ownership**: Both are subject to the same hierarchical ownership rules
- **Same Access Control**: Both follow the same READ/WRITE method restrictions

### Digital Infrastructure Structuring

This system enables organizations to structure their **complete digital infrastructure** around groups:

**Enterprise Use Cases:**
- **Employee Access**: Regular users logging into web dashboards with group-based permissions
- **System Integration**: API users enabling automated workflows and integrations  
- **Unified Management**: Single ownership hierarchy governing both human and system access
- **Consistent Security**: Same authorization model across all access methods

**Example: Trading Firm Structure**
- **Executives**: Regular users with broad read access across all groups via web interface
- **Traders**: Regular users with trading permissions in specific desk groups via mobile/web apps
- **Risk Systems**: API users with read-only access for automated monitoring and reporting
- **Order Management**: API users with trading permissions for algorithmic execution

Throughout the examples below, we reference "API users" for technical precision, but understand that **regular users would appear in identical organizational positions** with the same role assignments and access patterns.

## Group Hierarchy Model

Groups form tree structures with sophisticated ownership tracking:

### Ownership Fields

Each group (and every other resource) maintains two ownership fields:

- **`owner`** (Direct Owner): The immediate parent group that directly owns this resource
- **`owners`** (Ownership Path): An ordered array containing the complete ownership chain from root to immediate parent

```mermaid
graph TD
    subgraph "Group Ownership Fields"
        Root["Root Group<br/>name: groups/01ABC123...XYZ<br/>owner: groups/01ABC123...XYZ (self)<br/>owners: [groups/01ABC123...XYZ]"]
        
        CompanyA["Company A Group<br/>name: groups/01DEF456...ABC<br/>owner: groups/01ABC123...XYZ<br/>owners: [groups/01ABC123...XYZ, groups/01DEF456...ABC]"]
        
        TeamX["Team X Group<br/>name: groups/01GHI789...DEF<br/>owner: groups/01DEF456...ABC<br/>owners: [groups/01ABC123...XYZ, groups/01DEF456...ABC, groups/01GHI789...DEF]"]
        
        Account["User Account<br/>name: accounts/01JKL012...GHI<br/>owner: groups/01GHI789...DEF<br/>owners: [groups/01ABC123...XYZ, groups/01DEF456...ABC, groups/01GHI789...DEF]"]
        
        Root --> CompanyA
        CompanyA --> TeamX
        TeamX --> Account
    end
```

### Hierarchical Benefits

This denormalized structure provides:
- **Efficient Access Queries**: Find all resources accessible to a group with simple array membership checks
- **Permission Inheritance**: Resources inherit access permissions from all ancestors
- **Organizational Modeling**: Mirror real-world company structures and business units

## Everything is Owned

Every resource in Mesh has an owner group. This includes everything from clients, regular users, and API users through to accounts, financial instruments and different trade types.

```mermaid
graph TD
    subgraph "Universal Ownership Model"
        Root["ğŸ¢ Root Organization<br/>groups/01ROOT...ABC"]
        
        CompanyA["ğŸ¢ Company A<br/>groups/01COMP...DEF"]
        CompanyB["ğŸ¢ Company B<br/>groups/01COMP...GHI"]
        
        TeamAlpha["ğŸ‘¥ Team Alpha<br/>groups/01TEAM...JKL"]
        TeamBeta["ğŸ‘¥ Team Beta<br/>groups/01TEAM...MNO"]
        
        RegUser1["ğŸ‘¤ Regular User 1<br/>users/01USER...ABC<br/>Auth: Username/Password"]
        ApiUser1["ğŸ”‘ API User 1<br/>api_users/01API...PQR<br/>Auth: API Key"]
        
        RegUser2["ğŸ‘¤ Regular User 2<br/>users/01USER...DEF<br/>Auth: Google OAuth"]
        ApiUser2["ğŸ”‘ API User 2<br/>api_users/01API...STU<br/>Auth: API Key"]
        
        Account1["ğŸ’° Trading Account<br/>accounts/01ACC...VWX"]
        Account2["ğŸ’° Settlement Account<br/>accounts/01ACC...YZA"]
        
        Order1["ğŸ“Š Limit Order<br/>orders/01ORD...BCD<br/>Created by: Regular User"]
        Order2["ğŸ“Š Market Order<br/>orders/01ORD...EFG<br/>Created by: API User"]
        
        Instrument1["ğŸ¦ Bond Instrument<br/>instruments/01INS...HIJ"]
        
        Root --> CompanyA
        Root --> CompanyB
        
        CompanyA --> TeamAlpha
        CompanyA --> TeamBeta
        
        TeamAlpha --> RegUser1
        TeamAlpha --> ApiUser1
        TeamBeta --> RegUser2
        TeamBeta --> ApiUser2
        
        TeamAlpha --> Account1
        TeamBeta --> Account2
        
        Account1 --> Order1
        Account2 --> Order2
        
        CompanyA --> Instrument1
    end
```

## Access Control: Hierarchical vs Direct Ownership

The Mesh API enforces different access patterns based on method type:

### Reading Methods (METHOD_TYPE_READ)

**Rule**: Can access resources owned by your executing group OR any descendant groups in the hierarchy.

**Implementation**: Uses the `owners` array to check if the executing group appears anywhere in the ownership path.

```mermaid
graph TD
    subgraph "Read: Hierarchical Scope"
        Root["ğŸ¢ Root Group<br/>groups/ROOT"]
        CompanyA["ğŸ¢ Company A<br/>groups/COMP_A<br/>ğŸ” Executing Group"]
        TeamX["ğŸ‘¥ Team X<br/>groups/TEAM_X"]
        TeamY["ğŸ‘¥ Team Y<br/>groups/TEAM_Y"]
        
        Res1["ğŸ“Š Resource 1<br/>owners: [ROOT, COMP_A]<br/>âœ… Accessible"]
        Res2["ğŸ“Š Resource 2<br/>owners: [ROOT, COMP_A, TEAM_X]<br/>âœ… Accessible"]
        Res3["ğŸ“Š Resource 3<br/>owners: [ROOT, COMP_A, TEAM_Y]<br/>âœ… Accessible"]
        Res4["ğŸ“Š Resource 4<br/>owners: [ROOT, OTHER_COMP]<br/>âŒ Not Accessible"]
        
        Root --> CompanyA
        CompanyA --> TeamX
        CompanyA --> TeamY
        
        CompanyA -.-> Res1
        TeamX -.-> Res2
        TeamY -.-> Res3
        
        style CompanyA fill:#e1f5fe
        style Res1 fill:#c8e6c9
        style Res2 fill:#c8e6c9
        style Res3 fill:#c8e6c9
        style Res4 fill:#ffcdd2
    end
```

**Example**: If *executing* as Company A **Group**, you can read:
- Resources directly owned by Company A
- Resources owned by the Team X group (descendant)
- Resources owned by the Team Y group (descendant)
- But NOT resources owned by other company groups

### Writing Methods (METHOD_TYPE_WRITE)

**Rule**: Can only access resources directly owned by your **executing group**.

**Implementation**: Uses the `owner` field to check exact ownership match with executing group.

```mermaid
graph TD
    subgraph "Write: Direct Ownership"
        Root["ğŸ¢ Root Group<br/>groups/ROOT"]
        CompanyA["ğŸ¢ Company A<br/>groups/COMP_A<br/>ğŸ” Executing Group"]
        TeamX["ğŸ‘¥ Team X<br/>groups/TEAM_X"]
        TeamY["ğŸ‘¥ Team Y<br/>groups/TEAM_Y"]
        
        Res1["ğŸ“Š Resource 1<br/>owner: groups/COMP_A<br/>âœ… Writable"]
        Res2["ğŸ“Š Resource 2<br/>owner: groups/TEAM_X<br/>âŒ Not Writable"]
        Res3["ğŸ“Š Resource 3<br/>owner: groups/TEAM_Y<br/>âŒ Not Writable"]
        Res4["ğŸ“Š Resource 4<br/>owner: groups/OTHER_COMP<br/>âŒ Not Writable"]
        
        Root --> CompanyA
        CompanyA --> TeamX
        CompanyA --> TeamY
        
        CompanyA -.-> Res1
        TeamX -.-> Res2
        TeamY -.-> Res3
        
        style CompanyA fill:#e1f5fe
        style Res1 fill:#c8e6c9
        style Res2 fill:#ffcdd2
        style Res3 fill:#ffcdd2
        style Res4 fill:#ffcdd2
    end
```

**Example**: If executing as Company A, you can write:
- Only resources directly owned by Company A
- NOT resources owned by Team X or Team Y (even though they're descendants)
- NOT resources owned by other companies

## Integration with Role-Based Access Control

Groups work in conjunction with the role-based access control system:

### Authentication Flow

```mermaid
sequenceDiagram
    participant Client
    participant API
    participant AuthSystem
    participant ResourceService
    
    Client->>API: Request with x-api-key & x-group headers
    API->>AuthSystem: Validate API key & group context
    AuthSystem->>AuthSystem: Check user has required role in specified group
    AuthSystem->>API: Authentication successful
    API->>ResourceService: Execute with group context
    ResourceService->>ResourceService: Apply ownership filters based on method type
    ResourceService->>API: Return accessible resources
    API->>Client: Response with filtered data
```

### Role Assignment and Group Context

**API Credentials Structure:**
- **API Key**: Identifies the user
- **Group Context Header** (`x-group`): Specifies which group the operation executes within
- **Role Assignment**: User must have appropriate role assigned within the specified group

**Access Requirements:**
1. **Valid API Key**: Must be active and not expired
2. **Group Access**: User must have role assignment in the specified group
3. **Method Permissions**: User's role must include access to the specific API method
4. **Resource Ownership**: Resource must pass ownership filter based on method type

### Role-Based Method Access

```mermaid
graph TD
    subgraph "Role-Based Access Matrix"
        AdminRole["ğŸ‘¤ IAM Admin Role<br/>ROLE_IAM_ADMIN"]
        ViewerRole["ğŸ‘¤ IAM Viewer Role<br/>ROLE_IAM_VIEWER"]
        
        ReadMethods["ğŸ“– Read Methods<br/>GetGroup, ListGroups, SearchGroups<br/>METHOD_TYPE_READ"]
        WriteMethods["âœï¸ Write Methods<br/>CreateGroup, UpdateGroup<br/>METHOD_TYPE_WRITE"]
        
        AdminRole --> ReadMethods
        AdminRole --> WriteMethods
        ViewerRole --> ReadMethods
        ViewerRole -.-> WriteMethods
        
        style AdminRole fill:#c8e6c9
        style ViewerRole fill:#fff3e0
        style WriteMethods fill:#ffcdd2
    end
```

**Permission Model:**
- **Admin Roles** (`*_ADMIN`): Full read and write access to domain operations
- **Viewer Roles** (`*_VIEWER`): Read-only access for monitoring and auditing
- **Domain Separation**: Roles are scoped to specific business domains (IAM, Trading, Compliance, etc.)

### Example: Complete Access Check

For a `CreateGroup` operation:

1. **Authentication**: Validate API key and extract user identity
2. **Group Context**: Verify `x-group` header specifies valid group
3. **Role Check**: User must have `ROLE_IAM_ADMIN` or `ROLE_IAM_GROUP_ADMIN` in specified group
4. **Method Authorization**: `CreateGroup` requires write method permissions
5. **Ownership Validation**: New group's owner must match executing group (direct ownership rule)
6. **Hierarchy Update**: System automatically maintains `owners` array for new group

## Practical Examples

### Multi-Tenant Brokerage Platform

This example demonstrates how groups represent **legal entities** at every level of the hierarchy. Each group corresponds to a real-world legal entity (individual, corporation, trust, etc.) that undergoes KYC/compliance verification by its parent group.

**Legal Entity Hierarchy:**
- **Mesh Platform**: The root legal entity providing the platform infrastructure
- **Broker Companies**: Legal entities (corporations) that are KYC'd by Mesh and provide brokerage services
- **Client Entities**: Legal entities (individuals, companies, trusts) that are KYC'd by their respective brokers

```mermaid
graph TD
    subgraph "Brokerage Platform with Legal Entity Structure"
        Mesh["ğŸ¢ Mesh Platform (Legal Entity)<br/>groups/MESH_ROOT<br/>ğŸ“‹ Compliance Entity: Platform Provider"]
        MeshClient["ğŸ›ï¸ Mesh Client Entity<br/>clients/MESH_CLIENT<br/>ğŸ“‹ Legal Status: Corporation"]
        
        BrokerA["ğŸ¦ Broker A Corporation<br/>groups/BROKER_A<br/>ğŸ“‹ KYC'd by: Mesh Platform"]
        BrokerAClient["ğŸ¢ Broker A Client Entity<br/>clients/BROKER_A_CLIENT<br/>ğŸ“‹ Legal Status: Financial Services Corp"]
        
        BrokerB["ğŸ¦ Broker B LLC<br/>groups/BROKER_B<br/>ğŸ“‹ KYC'd by: Mesh Platform"]
        BrokerBClient["ğŸ¢ Broker B Client Entity<br/>clients/BROKER_B_CLIENT<br/>ğŸ“‹ Legal Status: Limited Liability Company"]
        
        ClientA1["ğŸ‘¤ Individual Client A1<br/>groups/CLIENT_A1<br/>ğŸ“‹ KYC'd by: Broker A"]
        ClientA1Entity["ğŸ‘¤ Client A1 Entity<br/>clients/CLIENT_A1_ENTITY<br/>ğŸ“‹ Legal Status: Natural Person"]
        A1RegUser["ğŸ‘¤ John Smith (Regular User)<br/>users/JOHN_SMITH<br/>ğŸ“‹ Auth: Username/Password<br/>ğŸ“‹ Role: Individual Trader"]
        A1ApiUser["ğŸ”‘ John's Trading Bot (API User)<br/>api_users/JOHN_BOT<br/>ğŸ“‹ Auth: API Key<br/>ğŸ“‹ Role: Automated Trading"]
        
        ClientA2["ğŸ¢ Corporate Client A2<br/>groups/CLIENT_A2<br/>ğŸ“‹ KYC'd by: Broker A"]
        ClientA2Entity["ğŸ¢ Client A2 Entity<br/>clients/CLIENT_A2_ENTITY<br/>ğŸ“‹ Legal Status: Investment Company"]
        A2RegUser["ğŸ‘¤ Sarah Johnson (Regular User)<br/>users/SARAH_JOHNSON<br/>ğŸ“‹ Auth: Google OAuth<br/>ğŸ“‹ Role: Portfolio Manager"]
        A2ApiUser["ğŸ”‘ Corp Risk System (API User)<br/>api_users/CORP_RISK<br/>ğŸ“‹ Auth: API Key<br/>ğŸ“‹ Role: Risk Monitoring"]
        
        ClientB1["ğŸ›ï¸ Trust Client B1<br/>groups/CLIENT_B1<br/>ğŸ“‹ KYC'd by: Broker B"]
        ClientB1Entity["ğŸ›ï¸ Client B1 Entity<br/>clients/CLIENT_B1_ENTITY<br/>ğŸ“‹ Legal Status: Family Trust"]
        B1RegUser["ğŸ‘¤ Trust Manager (Regular User)<br/>users/TRUST_MGR<br/>ğŸ“‹ Auth: SSO/SAML<br/>ğŸ“‹ Role: Trust Administrator"]
        
        AccA1["ğŸ’° Individual Trading Account<br/>accounts/ACC_A1_MAIN<br/>owner: CLIENT_A1<br/>owners: [MESH_ROOT, BROKER_A, CLIENT_A1]"]
        
        AccA2["ğŸ’° Corporate Trading Account<br/>accounts/ACC_A2_TRADE<br/>owner: CLIENT_A2<br/>owners: [MESH_ROOT, BROKER_A, CLIENT_A2]"]
        
        AccB1["ğŸ’° Trust Settlement Account<br/>accounts/ACC_B1_SETTLE<br/>owner: CLIENT_B1<br/>owners: [MESH_ROOT, BROKER_B, CLIENT_B1]"]
        
        OrderA1["ğŸ“Š Individual Buy Order<br/>orders/ORDER_BUY_123<br/>owner: CLIENT_A1<br/>owners: [MESH_ROOT, BROKER_A, CLIENT_A1]<br/>ğŸ’¡ Created via: Web Trading Interface"]
        
        OrderA2["ğŸ“Š Automated Sell Order<br/>orders/ORDER_SELL_456<br/>owner: CLIENT_A2<br/>owners: [MESH_ROOT, BROKER_A, CLIENT_A2]<br/>ğŸ’¡ Created via: API Integration"]
        
        Mesh --> MeshClient
        Mesh --> BrokerA
        Mesh --> BrokerB
        BrokerA --> BrokerAClient
        BrokerB --> BrokerBClient
        BrokerA --> ClientA1
        BrokerA --> ClientA2
        BrokerB --> ClientB1
        ClientA1 --> ClientA1Entity
        ClientA2 --> ClientA2Entity
        ClientB1 --> ClientB1Entity
        ClientA1 --> A1RegUser
        ClientA1 --> A1ApiUser
        ClientA2 --> A2RegUser
        ClientA2 --> A2ApiUser
        ClientB1 --> B1RegUser
        ClientA1 --> AccA1
        ClientA2 --> AccA2
        ClientB1 --> AccB1
        ClientA1 --> OrderA1
        ClientA2 --> OrderA2
    end
```

**Key Legal Entity Relationships:**

**Compliance Chain:**
- **Mesh Platform** â† KYC'd by regulators/auditors â† **Broker A & B** â† KYC'd by Mesh â† **Client Entities** â† KYC'd by their brokers

**Entity Types Supported:**
- **Natural Persons**: Individual traders and investors (`CLIENT_A1`)
- **Corporations**: Investment companies and fund managers (`CLIENT_A2`)
- **Trusts & Foundations**: Estate planning and wealth management entities (`CLIENT_B1`)
- **Financial Institutions**: Broker-dealers and registered investment advisors (`BROKER_A`, `BROKER_B`)

**Access Scenarios:**

**Broker A Admin executing ListAccounts (READ method):**
- âœ… Can see Account A1-Main (descendant: CLIENT_A1)
- âœ… Can see Account A2-Trading (descendant: CLIENT_A2)  
- âŒ Cannot see Account B1-Settlement (different broker)

**John Smith (Regular User) executing CreateOrder via Web Interface (WRITE method):**
- âœ… Can create orders owned by CLIENT_A1 (his legal entity group)
- âŒ Cannot create orders owned by CLIENT_A2 (different client)
- âŒ Cannot create orders owned by BROKER_A (not direct ownership)
- **Access Method**: Logs in via username/password, same authorization rules apply

**John's Trading Bot (API User) executing CreateOrder via API (WRITE method):**
- âœ… Can create orders owned by CLIENT_A1 (same ownership as regular user)
- âŒ Cannot create orders owned by CLIENT_A2 (different client)
- âŒ Cannot create orders owned by BROKER_A (not direct ownership)
- **Access Method**: Authenticates via API key, identical permissions to regular user

**Sarah Johnson (Regular User) executing GetAccount via Mobile App (READ method):**
- âœ… Can view CLIENT_A2 corporate accounts (her group's resources)
- âœ… Can view parent group accounts (hierarchical READ access)
- âŒ Cannot view CLIENT_A1 individual accounts (different client branch)
- **Cross-Platform**: Same permissions whether using web dashboard, mobile app, or desktop client

**Corporate Risk System (API User) executing ListOrders via API (READ method):**
- âœ… Can read all CLIENT_A2 orders for risk analysis
- âœ… Can read parent group data for consolidated reporting
- âŒ Cannot read CLIENT_A1 orders (different ownership branch)
- **Automation**: Enables automated risk monitoring with same permission model

### Investment Bank with Fund Structures

This example shows how complex financial institutions organize multiple fund structures, departments, and trading desks within a single institutional hierarchy. Each level represents distinct legal entities with their own compliance requirements and operational structures.

```mermaid
graph TD
    subgraph "Investment Bank Organizational Structure"
        Bank["ğŸ›ï¸ Goldman Sachs International<br/>groups/GOLDMAN_INTL<br/>ğŸ“‹ Legal Entity: Investment Bank"]
        BankClient["ğŸ¢ Goldman Client Entity<br/>clients/GOLDMAN_CLIENT<br/>ğŸ“‹ Legal Status: Financial Institution"]
        
        subgraph "Fund Structures"
            AlphaFund["ğŸ’¼ Alpha Hedge Fund LP<br/>groups/ALPHA_FUND<br/>ğŸ“‹ Legal Entity: Limited Partnership<br/>ğŸ“‹ KYC'd by: Goldman Sachs"]
            AlphaFundClient["ğŸ“Š Alpha Fund Client<br/>clients/ALPHA_FUND_CLIENT<br/>ğŸ“‹ Legal Status: Investment Vehicle"]
            
            BetaFund["ğŸ’¼ Beta Real Estate Fund<br/>groups/BETA_FUND<br/>ğŸ“‹ Legal Entity: REIT Corporation<br/>ğŸ“‹ KYC'd by: Goldman Sachs"]
            BetaFundClient["ğŸ¢ Beta Fund Client<br/>clients/BETA_FUND_CLIENT<br/>ğŸ“‹ Legal Status: REIT Corporation"]
        end
        
        subgraph "Alpha Fund Departments"
            AlphaResearch["ğŸ”¬ Alpha Research Division<br/>groups/ALPHA_RESEARCH<br/>ğŸ“‹ Internal Department"]
            AlphaRisk["âš–ï¸ Alpha Risk Management<br/>groups/ALPHA_RISK<br/>ğŸ“‹ Internal Department"]
        end
        
        subgraph "Trading Desks"
            BondDesk["ğŸ“ˆ Fixed Income Desk<br/>groups/BOND_DESK<br/>ğŸ“‹ Trading Department<br/>ğŸ“‹ Specialization: Government & Corporate Bonds"]
            ForexDesk["ğŸ’± Foreign Exchange Desk<br/>groups/FOREX_DESK<br/>ğŸ“‹ Trading Department<br/>ğŸ“‹ Specialization: Currency Trading"]
            MetalsDesk["ğŸ¥‡ Precious Metals Desk<br/>groups/METALS_DESK<br/>ğŸ“‹ Trading Department<br/>ğŸ“‹ Specialization: Gold, Silver, Commodities"]
        end
        
        subgraph "Users & System Access"
            BondTrader["ğŸ‘¤ Bond Trader (Regular User)<br/>users/BOND_TRADER_001<br/>ğŸ“‹ Auth: SSO/Active Directory<br/>ğŸ“‹ Access: Trading Terminal"]
            BondTradingBot["ğŸ”‘ Bond Algo System (API User)<br/>api_users/BOND_ALGO<br/>ğŸ“‹ Auth: API Key<br/>ğŸ“‹ Access: Automated Trading"]
            
            ForexAnalyst["ğŸ‘¤ FX Analyst (Regular User)<br/>users/FX_ANALYST_001<br/>ğŸ“‹ Auth: Username/Password<br/>ğŸ“‹ Access: Risk Dashboard"]
            ForexPricingAPI["ğŸ”‘ FX Pricing Feed (API User)<br/>api_users/FX_PRICING<br/>ğŸ“‹ Auth: API Key<br/>ğŸ“‹ Access: Market Data"]
            
            MetalsManager["ğŸ‘¤ Metals Desk Head (Regular User)<br/>users/METALS_HEAD<br/>ğŸ“‹ Auth: Smart Card + PIN<br/>ğŸ“‹ Access: Management Console"]
        end
        
        subgraph "Accounts & Trading Activity"
            AlphaFundAcc["ğŸ’° Alpha Fund Master Account<br/>accounts/ALPHA_MASTER_ACC<br/>owner: ALPHA_FUND<br/>Balance: $500M"]
            
            BetaFundAcc["ğŸ’° Beta Fund Property Account<br/>accounts/BETA_PROPERTY_ACC<br/>owner: BETA_FUND<br/>Balance: $200M"]
            
            AlphaResearchAcc["ğŸ’° Research Analysis Account<br/>accounts/ALPHA_RESEARCH_ACC<br/>owner: ALPHA_RESEARCH<br/>Balance: $5M"]
            
            BondDeskAcc["ğŸ’° Bond Trading Account<br/>accounts/BOND_TRADING_ACC<br/>owner: BOND_DESK<br/>Balance: $50M"]
            
            ForexDeskAcc["ğŸ’° FX Trading Account<br/>accounts/FOREX_TRADING_ACC<br/>owner: FOREX_DESK<br/>Balance: $75M"]
            
            MetalsDeskAcc["ğŸ’° Metals Trading Account<br/>accounts/METALS_TRADING_ACC<br/>owner: METALS_DESK<br/>Balance: $25M"]
            
            GoldTrade["ğŸ“Š Gold Futures Order<br/>orders/GOLD_FUTURES_001<br/>owner: METALS_DESK<br/>Amount: $2M Long Position<br/>ğŸ’¡ Created by: Regular User via Terminal"]
            
            BondTrade["ğŸ“Š Treasury Bond Order<br/>orders/TREASURY_BOND_001<br/>owner: BOND_DESK<br/>Amount: $10M 10-Year Notes<br/>ğŸ’¡ Created by: API Integration"]
            
            FXTrade["ğŸ“Š EUR/USD Trade<br/>orders/EUR_USD_001<br/>owner: FOREX_DESK<br/>Amount: â‚¬5M Currency Swap<br/>ğŸ’¡ Created by: Regular User via Dashboard"]
        end
        
        Bank --> BankClient
        Bank --> AlphaFund
        Bank --> BetaFund
        Bank --> BondDesk
        Bank --> ForexDesk
        Bank --> MetalsDesk
        
        BondDesk --> BondTrader
        BondDesk --> BondTradingBot
        ForexDesk --> ForexAnalyst
        ForexDesk --> ForexPricingAPI
        MetalsDesk --> MetalsManager
        
        AlphaFund --> AlphaFundClient
        BetaFund --> BetaFundClient
        AlphaFund --> AlphaResearch
        AlphaFund --> AlphaRisk
        
        AlphaFund --> AlphaFundAcc
        BetaFund --> BetaFundAcc
        AlphaResearch --> AlphaResearchAcc
        BondDesk --> BondDeskAcc
        ForexDesk --> ForexDeskAcc
        MetalsDesk --> MetalsDeskAcc
        
        MetalsDesk --> GoldTrade
        BondDesk --> BondTrade
        ForexDesk --> FXTrade
    end
```

**Multi-Level Organizational Structure:**

**Investment Bank Level (`GOLDMAN_INTL`):**
- **Primary Legal Entity**: Licensed investment bank with regulatory oversight
- **Direct Children**: Fund structures and trading desks
- **Access Rights**: Can read all descendant fund and desk activities (hierarchical READ access)
- **Compliance Role**: Consolidated reporting and regulatory compliance for all subsidiaries

**Fund Level (`ALPHA_FUND`, `BETA_FUND`):**
- **Legal Structure**: Separate legal entities (LP, REIT) with independent governance
- **Fund Departments**: Internal divisions for research, risk management, operations
- **Fund Accounts**: Master accounts holding pooled investor capital
- **Access Rights**: Full control over fund-specific resources, limited access to bank-level resources

**Department Level (`ALPHA_RESEARCH`, `BOND_DESK`, etc.):**
- **Operational Units**: Functional departments within larger entities
- **Specialized Accounts**: Department-specific trading and operational accounts  
- **Trading Activity**: Orders and positions managed at department level
- **Access Rights**: Direct ownership of department resources only

**Access Control Scenarios:**

**Goldman Sachs Bank Admin executing ListAccounts (READ method):**
- âœ… Can see all fund accounts (`ALPHA_MASTER_ACC`, `BETA_PROPERTY_ACC`)
- âœ… Can see all desk accounts (`BOND_TRADING_ACC`, `FOREX_TRADING_ACC`, `METALS_TRADING_ACC`)
- âœ… Can see all department accounts (`ALPHA_RESEARCH_ACC`)
- **Use Case**: Consolidated risk monitoring and regulatory reporting across all entities

**Bond Trader (Regular User) executing CreateOrder via Trading Terminal (WRITE method):**
- âœ… Can create orders owned by `BOND_DESK` (his department group)
- âŒ Cannot create orders owned by `FOREX_DESK` (different desk)
- âŒ Cannot create orders owned by `ALPHA_FUND` (different entity level)
- **Authentication**: SSO/Active Directory with role-based terminal access
- **Interface**: Desktop trading terminal with real-time market data

**Bond Algo System (API User) executing CreateOrder via API (WRITE method):**
- âœ… Can create orders owned by `BOND_DESK` (same permissions as regular trader)
- âŒ Cannot create orders owned by `FOREX_DESK` (same restrictions apply)
- âŒ Cannot create orders owned by `ALPHA_FUND` (entity separation maintained)
- **Authentication**: API key with identical authorization scope as regular users
- **Integration**: Automated algorithmic trading with same business rules

**FX Analyst (Regular User) executing GetAccount via Risk Dashboard (READ method):**
- âœ… Can view `FOREX_TRADING_ACC` (his desk's account)
- âœ… Can view parent bank accounts (hierarchical READ access)
- âŒ Cannot view `BOND_TRADING_ACC` (different desk, sibling level)
- **Access Method**: Web-based risk dashboard with real-time position monitoring
- **Cross-Platform**: Same permissions via mobile app or web interface

**Metals Desk Head (Regular User) executing UpdateAccount via Management Console (WRITE method):**
- âœ… Can update `METALS_TRADING_ACC` (directly owned by his desk)
- âŒ Cannot update `ALPHA_MASTER_ACC` (fund-owned account, different entity)
- âŒ Cannot update `BOND_TRADING_ACC` (different desk, sibling relationship)
- **Authentication**: Smart card + PIN for high-privilege operations
- **Use Case**: Desk-level account management with enhanced security requirements

**Compliance and Risk Benefits:**
- **Regulatory Segregation**: Each fund maintains separate compliance and reporting
- **Risk Isolation**: Department failures don't impact other organizational units
- **Operational Efficiency**: Specialized access patterns for different business functions
- **Consolidated Oversight**: Bank-level visibility for enterprise risk management

### Isolation Guarantees

- **Complete Tenant Separation**: Resources in one group hierarchy cannot access resources in another
- **Inheritance Control**: Parent groups gain read access to descendant resources but not write access
- **Permission Boundaries**: Role assignments are scoped to specific groups

## Related Documentation

- **[Role-Based Access Control](./role-based-access)** - Understanding the role system that works with groups
- **[Authentication](./authentication)** - API key and group context authentication
- **[Group Service API Reference](/docs/api-reference/iam/group/v1)** - Complete API documentation for group management operations